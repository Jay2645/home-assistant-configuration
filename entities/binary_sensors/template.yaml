platform: template
sensors:
  cuties_asleep:
    value_template: >-
      {{ (is_state('media_player.bedroom_speaker', 'playing') or is_state('media_player.bedroom_speaker', 'idle'))
         and states.media_player.bedroom_speaker.attributes.media_title == "Rain sounds" }}
    # 15 second delay to avoid false positives when server restarts
    delay_off:
      seconds: 15
  speakers_playing: 
    value_template: >-
      {{ is_state('media_player.bedroom_speaker', 'playing') 
         or is_state('media_player.office_speaker', 'playing')
         or is_state('media_player.bathroom_speaker', 'playing') }}
  cutie_home:
    value_template: >-
      {{ is_state('person.jay', 'home') 
         or is_state('person.michelle', 'home') }}
  server_up:
    value_template: >-
      {{float(states.sensor.uptime.state) >= 1}}
  tesla_initialized:
    value_template: '{{ float(states.sensor.euphrates_eevie_mileage_sensor.state) > 0 }}'
  bedroom_chromecast_on:
    value_template: "{{ is_state_attr('remote.harmony_hub', 'current_activity', 'Watch Chromecast') }}"
  bedroom_chromecast_playing:
    value_template: "{{ is_state('media_player.bedroom_tv', 'playing') and is_state('binary_sensor.bedroom_chromecast_on', 'on') }}"
  bedroom_videogames_on:
    value_template: "{{ is_state_attr('remote.harmony_hub', 'current_activity', 'Play Videogames') }}"
  bedroom_watching_long_media:
    value_template: "{{ is_state('binary_sensor.bedroom_chromecast_playing', 'on') and (states.sensor.bedroom_chromecast_duration.state|float / 60) >= 20 }}"
